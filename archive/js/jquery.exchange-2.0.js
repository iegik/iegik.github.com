(function( $ ){

		/*
		 * Generates option list with Currencies
		 * <select id="currency-exchange" data-rate="{current currency rate}">
		 *   <option data-sign="{currency sign}" value="{currency rate}">{currency abbrivation} {currency title}</option>
		 * </select>
		 * 
		 * $("#currency-exchange").exchange({
		 *   data: "{copy from www.bank.lv/vk/xml.xml}",
		 *   prices: "{class, where is the prices, that needed to convert}"
		 * })
		 */
		$.fn.exchange = function (options){
			var settings = {
				data: "xml.xml", //TODO: Get and cache (JSON) this file from www.bank.lv/vk/xml.xml
				prices: ".price-value",
				currentcurrency: "USD",
				defaultcurrency: "LVL",
				currencytitles: {
      "AED" : "United Arab Emirates, Dirhams",
      "AFN" : "Afghanistan, Afghanis",
      "ALL" : "Albania, Leke",
      "AMD" : "Armenia, Drams",
      "ANG" : "Netherlands Antilles, Guilders (also called Florins)",
      "AOA" : "Angola, Kwanza",
      "ARS" : "Argentina, Pesos",
      "AUD" : "Australia, Dollars",
      "AWG" : "Aruba, Guilders (also called Florins)",
      "AZN" : "Azerbaijan, New Manats",
      "BAM" : "Bosnia and Herzegovina, Convertible Marka",
      "BBD" : "Barbados, Dollars",
      "BDT" : "Bangladesh, Taka",
      "BGN" : "Bulgaria, Leva",
      "BHD" : "Bahrain, Dinars",
      "BIF" : "Burundi, Francs",
      "BMD" : "Bermuda, Dollars",
      "BND" : "Brunei Darussalam, Dollars",
      "BOB" : "Bolivia, Bolivianos",
      "BRL" : "Brazil, Brazil Real",
      "BSD" : "Bahamas, Dollars",
      "BTN" : "Bhutan, Ngultrum",
      "BWP" : "Botswana, Pulas",
      "BYR" : "Belarus, Rubles",
      "BZD" : "Belize, Dollars",
      "CAD" : "Canada, Dollars",
      "CDF" : "Congo/Kinshasa, Congolese Francs",
      "CHF" : "Switzerland, Francs",
      "CLP" : "Chile, Pesos",
      "CNY" : "China, Yuan Renminbi",
      "COP" : "Colombia, Pesos",
      "CRC" : "Costa Rica, Colones",
      "CUP" : "Cuba, Pesos",
      "CVE" : "Cape Verde, Escudos",
      "CYP" : "Cyprus, Pounds (expires 2008-Jan-31)",
      "CZK" : "Czech Republic, Koruny",
      "DJF" : "Djibouti, Francs",
      "DKK" : "Denmark, Kroner",
      "DOP" : "Dominican Republic, Pesos",
      "DZD" : "Algeria, Algeria Dinars",
      "EEK" : "Estonia, Krooni",
      "EGP" : "Egypt, Pounds",
      "ERN" : "Eritrea, Nakfa",
      "ETB" : "Ethiopia, Birr",
      "EUR" : "Euro Member Countries, Euro",
      "FJD" : "Fiji, Dollars",
      "FKP" : "Falkland Islands (Malvinas), Pounds",
      "GBP" : "United Kingdom, Pounds",
      "GEL" : "Georgia, Lari",
      "GGP" : "Guernsey, Pounds",
      "GHS" : "Ghana, Cedis",
      "GIP" : "Gibraltar, Pounds",
      "GMD" : "Gambia, Dalasi",
      "GNF" : "Guinea, Francs",
      "GTQ" : "Guatemala, Quetzales",
      "GYD" : "Guyana, Dollars",
      "HKD" : "Hong Kong, Dollars",
      "HNL" : "Honduras, Lempiras",
      "HRK" : "Croatia, Kuna",
      "HTG" : "Haiti, Gourdes",
      "HUF" : "Hungary, Forint",
      "IDR" : "Indonesia, Rupiahs",
      "ILS" : "Israel, New Shekels",
      "IMP" : "Isle of Man, Pounds",
      "INR" : "India, Rupees",
      "IQD" : "Iraq, Dinars",
      "IRR" : "Iran, Rials",
      "ISK" : "Iceland, Kronur",
      "JEP" : "Jersey, Pounds",
      "JMD" : "Jamaica, Dollars",
      "JOD" : "Jordan, Dinars",
      "JPY" : "Japan, Yen",
      "KES" : "Kenya, Shillings",
      "KGS" : "Kyrgyzstan, Soms",
      "KHR" : "Cambodia, Riels",
      "KMF" : "Comoros, Francs",
      "KPW" : "Korea (North), Won",
      "KRW" : "Korea (South), Won",
      "KWD" : "Kuwait, Dinars",
      "KYD" : "Cayman Islands, Dollars",
      "KZT" : "Kazakhstan, Tenge",
      "LAK" : "Laos, Kips",
      "LBP" : "Lebanon, Pounds",
      "LKR" : "Sri Lanka, Rupees",
      "LRD" : "Liberia, Dollars",
      "LSL" : "Lesotho, Maloti",
      "LTL" : "Lithuania, Litai",
      "LVL" : "Latvia, Lati",
      "LYD" : "Libya, Dinars",
      "MAD" : "Morocco, Dirhams",
      "MDL" : "Moldova, Lei",
      "MGA" : "Madagascar, Ariary",
      "MKD" : "Macedonia, Denars",
      "MMK" : "Myanmar (Burma), Kyats",
      "MNT" : "Mongolia, Tugriks",
      "MOP" : "Macau, Patacas",
      "MRO" : "Mauritania, Ouguiyas",
      "MTL" : "Malta, Liri (expires 2008-Jan-31)",
      "MUR" : "Mauritius, Rupees",
      "MVR" : "Maldives (Maldive Islands), Rufiyaa",
      "MWK" : "Malawi, Kwachas",
      "MXN" : "Mexico, Pesos",
      "MYR" : "Malaysia, Ringgits",
      "MZN" : "Mozambique, Meticais",
      "NAD" : "Namibia, Dollars",
      "NGN" : "Nigeria, Nairas",
      "NIO" : "Nicaragua, Cordobas",
      "NOK" : "Norway, Krone",
      "NPR" : "Nepal, Nepal Rupees",
      "NZD" : "New Zealand, Dollars",
      "OMR" : "Oman, Rials",
      "PAB" : "Panama, Balboa",
      "PEN" : "Peru, Nuevos Soles",
      "PGK" : "Papua New Guinea, Kina",
      "PHP" : "Philippines, Pesos",
      "PKR" : "Pakistan, Rupees",
      "PLN" : "Poland, Zlotych",
      "PYG" : "Paraguay, Guarani",
      "QAR" : "Qatar, Rials",
      "RON" : "Romania, New Lei",
      "RSD" : "Serbia, Dinars",
      "RUB" : "Russia, Rubles",
      "RWF" : "Rwanda, Rwanda Francs",
      "SAR" : "Saudi Arabia, Riyals",
      "SBD" : "Solomon Islands, Dollars",
      "SCR" : "Seychelles, Rupees",
      "SDG" : "Sudan, Pounds",
      "SEK" : "Sweden, Kronor",
      "SGD" : "Singapore, Dollars",
      "SHP" : "Saint Helena, Pounds",
      "SLL" : "Sierra Leone, Leones",
      "SOS" : "Somalia, Shillings",
      "SPL" : "Seborga, Luigini",
      "SRD" : "Suriname, Dollars",
      "STD" : "São Tome and Principe, Dobras",
      "SVC" : "El Salvador, Colones",
      "SYP" : "Syria, Pounds",
      "SZL" : "Swaziland, Emalangeni",
      "THB" : "Thailand, Baht",
      "TJS" : "Tajikistan, Somoni",
      "TMM" : "Turkmenistan, Manats",
      "TND" : "Tunisia, Dinars",
      "TOP" : "Tonga, Pa'anga",
      "TRY" : "Turkey, New Lira",
      "TTD" : "Trinidad and Tobago, Dollars",
      "TVD" : "Tuvalu, Tuvalu Dollars",
      "TWD" : "Taiwan, New Dollars",
      "TZS" : "Tanzania, Shillings",
      "UAH" : "Ukraine, Hryvnia",
      "UGX" : "Uganda, Shillings",
      "USD" : "United States of America, Dollars",
      "UYU" : "Uruguay, Pesos",
      "UZS" : "Uzbekistan, Sums",
      "VEB" : "Venezuela, Bolivares (expires 2008-Jun-30)",
      "VEF" : "Venezuela, Bolivares Fuertes",
      "VND" : "Viet Nam, Dong",
      "VUV" : "Vanuatu, Vatu",
      "WST" : "Samoa, Tala",
      "XAF" : "Communauté Financière Africaine BEAC, Francs",
      "XAG" : "Silver, Ounces",
      "XAU" : "Gold, Ounces",
      "XCD" : "East Caribbean Dollars",
      "XDR" : "International Monetary Fund (IMF) Special Drawing Rights",
      "XOF" : "Communauté Financière Africaine BCEAO, Francs",
      "XPD" : "Palladium Ounces",
      "XPF" : "Comptoirs Français du Pacifique Francs",
      "XPT" : "Platinum, Ounces",
      "YER" : "Yemen, Rials",
      "ZAR" : "South Africa, Rand",
      "ZMK" : "Zambia, Kwacha",
      "ZWD" : "Zimbabwe, Zimbabwe Dollars"
				},
				currencysigns: {
			'AED'	: '&#1583;.&#1573;',
      'ALL' : 'Lek',
      'USD' : '$',
      'AFN' : '&#1547;',
      'ARS' : '$',
      'AWG' : '&#402;',
      'AUD' : '$',
      'AZN' : '&#1084;&#1072;&#1085;',
      'BSD' : '$',
      'BBD' : '$',
      'BYR' : 'p.',
      'EUR' : '&#8364;',
      'BZD' : 'BZ$',
      'BMD' : '$',
      'BOB' : '$b',
      'BAM' : 'KM',
      'BWP' : 'P',
      'BGN' : '&#1083;&#1074;',
      'BRL' : 'R$',
      'GBP' : '&#163;',
      'BND' : '$',
      'KHR' : '&#6107;',
      'CAD' : '$',
      'KYD' : '$',
      'CLP' : '$',
      'CNY' : '&#165;',
      'COP' : '$',
      'CRC' : '&#8353;',
      'HRK' : 'kn',
      'CUP' : '&#8369;',
      'EUR' : '&#8364;',
      'CZK' : 'K&#269;',
      'DKK' : 'kr',
      'DOP' : 'RD$',
      'XCD' : '$',
      'EGP' : '&#163;',
      'SVC' : '$',
      'GBP' : '&#163;',
      'EUR' : '&#8364;',
      'FKP' : '&#163;',
      'FJD' : '$',
      'EUR' : '&#8364;',
      'GHC' : '&#162;',
      'GIP' : '&#163;',
      'EUR' : '&#8364;',
      'GTQ' : 'Q',
      'GGP' : '&#163;',
      'GYD' : '$',
      'EUR' : '&#8364;',
      'HNL' : 'L',
      'HKD' : '$',
      'HUF' : 'Ft',
      'ISK' : 'kr',
      'INR' : '&#8360;',
      'IDR' : 'Rp',
      'IRR' : '&#65020;',
      'EUR' : '&#8364;',
      'IMP' : '&#163;',
      'ILS' : '&#8362;',
      'EUR' : '&#8364;',
      'JMD' : 'J$',
      'JPY' : '&#165;',
      'JEP' : '&#163;',
      'KZT' : '&#1083;&#1074;',
      'KPW' : '&#8361;',
      'KRW' : '&#8361;',
      'KGS' : '&#1083;&#1074;',
      'LAK' : '&#8365;',
      'LVL' : 'Ls',
      'LBP' : '&#163;',
      'LRD' : '$',
      'CHF' : '&#8355;',
      'LTL' : 'Lt',
      'EUR' : '&#8364;',
      'MKD' : '&#1076;&#1077;&#1085;',
      'MYR' : 'RM',
      'EUR' : '&#8364;',
      'MAD' : 'Dh',
      'MDL' : 'leu',
      'MUR' : '&#8360;',
      'MXN' : '$',
      'MNT' : '&#8366;',
      'MZN' : 'MT',
      'NAD' : '$',
      'NPR' : '&#8360;',
      'ANG' : '&#402;',
      'EUR' : '&#8364;',
      'NZD' : '$',
      'NIO' : 'C$',
      'NGN' : '&#8358;',
      'KPW' : '&#8361;',
      'NOK' : 'kr',
      'OMR' : '&#65020;',
      'PKR' : '&#8360;',
      'PAB' : 'B/.',
      'PYG' : 'Gs',
      'PEN' : 'S/.',
      'PHP' : 'Php',
      'PLN' : 'z&#322;',
      'QAR' : '&#65020;',
      'RON' : 'lei',
      'RUB' : '&#1088;&#1091;&#1073;',
      'SHP' : '&#163;',
      'SAR' : '&#65020;',
      'RSD' : '&#1044;&#1080;&#1085;.',
      'SCR' : '&#8360;',
      'SGD' : '$',
      'EUR' : '&#8364;',
      'SBD' : '$',
      'SOS' : 'S',
      'ZAR' : 'R',
      'KRW' : '&#8361;',
      'EUR' : '&#8364;',
      'LKR' : '&#8360;',
      'SEK' : 'kr',
      'SRD' : '$',
      'SDR' : 'SDRs',
      'SYP' : '&#163;',
      'TWD' : 'NT$',
      'THB' : '&#3647;',
      'TTD' : 'TT$',
      'TRY' : 'TL',
      'TRL' : '&#8356;',
      'TVD' : '$',
      'TND' : '&#1583;.&#1578;',
      'UAH' : '&#8372;',
      'GBP' : '&#163;',
      'USD' : '$',
      'UYU' : '$U',
      'UZS' : '&#1083;&#1074;',
      'EUR' : '&#8364;',
      'VEF' : 'Bs',
      'VND' : '&#8363;',
      'YER' : '&#65020;',
      'ZWD' : 'Z$',
      'XDR' : '',
      'XAU' : 'Au',
				}
   		};
   		
   		return this.each(function() {
		    if ( options ) { 
		      $.extend( settings, options );
		    }
				var e = $(this);
				$.ajax({
					type: "GET",
					crossDomain: true,
					dataType: "xml",
					url: settings['data'],
					success: function(xml) {
						e.html('<option data-sign="' + settings['currencysigns'][settings['defaultcurrency']] + '" value="1">' + settings['defaultcurrency'] + ' ' + settings['currencytitles'][settings['defaultcurrency']] + '</option>'); //TODO: Change .currency-exchange class to undepended variable
						$(xml).find('Currency').each(function(){ //TODO: item { 
							var currency = $(this).find('ID').text(),
								rate = $(this).find('Units').text() * $(this).find('Rate').text(),
								selected = '';
							if(currency == settings['currentcurrency']){
								var selected = 'selected';
								e.attr('data-rate',rate);
							}
							$('<option '+selected+' data-sign="' + settings['currencysigns'][currency] + '"></option>')
								.text(currency + ' ' + settings['currencytitles'][currency])
								.val(rate)
								.appendTo(e);
						});
						e.change(function(){
							$this = $(this);
							$(settings['prices']).each(function(){
								if($(this).val()){
									var value = $(this).val();
								}else{
									var value = $(this).text();
								}
								var result = value * $this.attr('data-rate') / $this.val();
								result = Math.round(result * 100)/100;
								$(this).val(result);
								$(this).text(result);
								var sign = $this.find("option:selected").attr("data-sign");
								$(this).next('span').text(sign)
								if(sign == "$"){
									$(this).next('span').css('float','left');
								}else{
									$(this).next('span').css('float','right');
								}
							});
							$this.attr('data-rate',$this.val());
							
						});
					}
				});
		  });
		}
})( jQuery );
